#!/bin/bash

# Check if the script is run as root
if [ "$EUID" -ne 0 ]; then
    echo "Please run the script as root (use sudo)"
    exit 1
fi

# Install ufw if not already installed
apt-get update
apt-get install -y ufw

# Reset ufw to default settings
ufw --force reset

# Set default policies
ufw default deny incoming
ufw default allow outgoing

# Allow SSH (port 22)
ufw allow 22/tcp

# Allow HTTP (port 80)
ufw allow 80/tcp

# Allow HTTPS (port 443)
ufw allow 443/tcp

# Forward port 8080 to port 80
sh -c 'echo "*nat\n:PREROUTING ACCEPT [0:0]\n-A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80\nCOMMIT" > /etc/ufw/before.rules'

# Enable ufw
ufw --force enable
